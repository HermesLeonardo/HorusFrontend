
<div class="admin-dashboard">

  <!-- üîπ Se√ß√£o 1: Vis√£o Geral (Cards de M√©tricas) -->
  <section class="dashboard-overview">
    <div class="dashboard-card" *ngIf="userRole === 'ROLE_ADMIN'">
      <h3>Total de Projetos</h3>
      <p>{{ totalProjetos }}</p>
    </div>
    <div class="dashboard-card">
      <h3>Total de Atividades</h3>
      <p>{{ totalAtividades }}</p>
    </div>
    <div class="dashboard-card">
      <h3>Total de Horas Lan√ßadas</h3>
      <p>{{ totalHorasLancadas }}</p>
    </div>
    <div class="dashboard-card" *ngIf="userRole === 'ROLE_ADMIN'">
      <h3>Total de Usu√°rios</h3>
      <p>{{ totalUsuarios }}</p>
    </div>
  </section>

  <!-- üîπ Se√ß√£o 2: Status Resumido dos Projetos e Atividades -->
  <section class="dashboard-project-status">
    <div class="dashboard-content"> <!-- üîπ Esse container faz o flex funcionar -->

      <!-- üîπ Gr√°fico -->
      <div class="chart-container">
        <canvas id="projetosChart"></canvas>
      </div>

      <!-- üîπ Se√ß√£o de Filtros -->
      <div class="filter-container">
        <h3>Filtros</h3>

        <!-- üîπ Filtro de Per√≠odo -->
        <label for="filtroPeriodo">Per√≠odo:</label>
        <select id="filtroPeriodo" [value]="filtroPeriodo" (change)="atualizarGrafico($event.target.value)">
          <option value="7">√öltimos 7 dias</option>
          <option value="30">√öltimos 30 dias</option>
          <option value="todos">Todos</option>
        </select>

        <!-- üîπ Alternar Tipo de Gr√°fico -->
        <button (click)="alternarTipoGrafico()">üîÑ Alternar Gr√°fico</button>

        <!-- üîπ Filtros de Status -->
        <h4>Status dos Projetos:</h4>
        <div *ngFor="let status of statusProjetos">
          <input type="checkbox" [id]="status" [(ngModel)]="statusSelecionadosProjetos[status]"
            (change)="atualizarGrafico()">
          <label [for]="status">{{ status }}</label>
        </div>

        <h4>Status das Atividades:</h4>
        <div *ngFor="let status of statusAtividades">
          <input type="checkbox" [id]="status" [(ngModel)]="statusSelecionadosAtividades[status]"
            (change)="atualizarGrafico()">
          <label [for]="status">{{ status }}</label>
        </div>
      </div>

    </div> <!-- üîπ Fim de .dashboard-content -->
  </section>


  <!-- üîπ Se√ß√£o 3: √öltimos Projetos Criados -->
  <section class="dashboard-recent-projects" *ngIf="userRole === 'ROLE_ADMIN'">
    <h2>√öltimos Projetos Criados</h2>
    <table class="dashboard-table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Descri√ß√£o</th>
          <th>Respons√°vel</th>
          <th>Atividades</th>
          <th>Status</th>
          <th>Data de Cria√ß√£o</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let projeto of projetosRecentes" [ngClass]="{
              'projeto-parado': projeto.diasSemAtividade > 10,
              'projeto-prazo': projeto.prazoProximo
            }">
          <td>{{ projeto.nome }}</td>
          <td>{{ projeto.descricao || 'Sem descri√ß√£o' }}</td>
          <td>{{ projeto.usuarioResponsavel?.nome || 'N√£o atribu√≠do' }}</td>
          <td>{{ projeto.quantidadeAtividades }}</td>
          <td>
            <select [(ngModel)]="projeto.status" (change)="atualizarStatusProjeto(projeto)">
              <option value="PLANEJADO">Planejado</option>
              <option value="EM_ANDAMENTO">Em Andamento</option>
              <option value="CONCLUIDO">Conclu√≠do</option>
              <option value="CANCELADO">Cancelado</option>
            </select>
          </td>
          <td>{{ projeto.dataCriacao | date:'dd/MM/yyyy' }}</td>
          <td>
            <button (click)="abrirPicklistResponsaveis(projeto)">üë• Gerenciar Respons√°veis</button>
          </td>
        </tr>
      </tbody>
    </table>
  </section>


<!-- üîπ Modal Customizado para PickList -->
<div class="custom-modal-picklist" *ngIf="exibirPicklist">
  <div class="custom-modal-picklist-content">
    <h2>Gerenciar Respons√°veis</h2>

    <p-pickList [source]="usuariosDisponiveis" [target]="responsaveisSelecionados"
                sourceHeader="Usu√°rios Dispon√≠veis" targetHeader="Respons√°veis"
                (onMoveToTarget)="atualizarResponsaveis(projetoSelecionado)"
                (onMoveToSource)="atualizarResponsaveis(projetoSelecionado)">
      <ng-template let-item pTemplate="item">{{ item.nome }}</ng-template>
    </p-pickList>

    <div class="modal-footer">
      <button class="fechar-btn" (click)="fecharPicklist()">Fechar</button>
      <button class="salvar-btn" (click)="salvarResponsaveis()">Salvar</button>
    </div>
  </div>
</div>



  <!-- üîπ Se√ß√£o 4: Atividades Pendentes -->
  <section class="dashboard-pending-tasks">
    <h2>Atividades Pendentes</h2>
    <table class="dashboard-table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Respons√°vel</th>
          <th>Data de Vencimento</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let atividade of atividadesPendentes">
          <td>{{ atividade.nome }}</td>
          <td>{{ atividade.responsavel }}</td>
          <td>{{ atividade.dataFim | date:'dd/MM/yyyy' }}</td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- üîπ Se√ß√£o 5: √öltimos Logins -->
  <section class="dashboard-last-logins" *ngIf="userRole === 'ROLE_ADMIN'">
    <h2>√öltimos Logins</h2>
    <table class="dashboard-table">
      <thead>
        <tr>
          <th>Usu√°rio</th>
          <th>Email</th>
          <th>√öltimo Login</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let usuario of ultimosLogins">
          <td>{{ usuario.nome }}</td>
          <td>{{ usuario.email }}</td>
          <td>{{ usuario.ultimoLogin | date:'dd/MM/yyyy HH:mm' }}</td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- üîπ Se√ß√£o 6: A√ß√µes R√°pidas -->
  <section class="dashboard-quick-actions" *ngIf="userRole === 'ROLE_ADMIN'">
    <h2>A√ß√µes R√°pidas</h2>
    <div class="quick-actions-container">
      <button (click)="abrirDialogProjeto()">‚ûï Criar Novo Projeto</button>
      <button (click)="criarNovaAtividade()">üìå Criar Nova Atividade</button>
      <button (click)="acessarRelatorios()">üìä Acessar Relat√≥rios</button>
      <button (click)="gerenciarUsuarios()">üë§ Gerenciar Usu√°rios</button>
    </div>
  </section>

</div>