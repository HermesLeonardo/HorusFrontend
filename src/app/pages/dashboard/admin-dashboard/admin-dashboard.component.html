<div class="dashboard-container" [ngClass]="{ 'expanded': !isCollapsed, 'collapsed': isCollapsed }">

  <!-- Cards de Atividades -->
  <div class="activity-cards">
    <div class="card" (click)="abrirAtividades('ABERTA')">
      <h3>Atividades Abertas</h3>
      <p class="value">{{ atividadesAbertas.length }}</p>
      <p class="status positivo">+12% ‚Üë</p>
    </div>
    <div class="card" (click)="abrirAtividades('EM_ANDAMENTO')">
      <h3>Atividades em Andamento</h3>
      <p class="value">{{ atividadesEmAndamento.length }}</p>
      <p class="status positivo">+8% ‚Üë</p>
    </div>
    <div class="card" (click)="abrirAtividades('CONCLUIDA')">
      <h3>Atividades Conclu√≠das</h3>
      <p class="value">{{ atividadesConcluidas.length }}</p>
      <p class="status positivo">+20% ‚Üë</p>
    </div>
    <div class="card" (click)="abrirAtividades('PAUSADA')">
      <h3>Atividades Pausadas</h3>
      <p class="value">{{ atividadesPausadas.length }}</p>
      <p class="status negativo">-5% ‚Üì</p>
    </div>
  </div>

  <!-- ================== IN√çCIO: MODAL DE PROJETO ================== -->
  <div class="custom-modal-overlay" *ngIf="projetoDialogVisivel">
    <div class="custom-modal">
      <h2>Detalhes do Projeto</h2>
      <div class="modal-body">
        <label for="nome">Nome:</label>
        <input id="nome" type="text" [(ngModel)]="projetoSelecionado.nome">

        <label for="status">Status:</label>
        <select id="status" [(ngModel)]="projetoSelecionado.status">
          <option value="PLANEJAMENTO">Planejamento</option>
          <option value="EM_ANDAMENTO">Em Andamento</option>
          <option value="CONCLUIDO">Conclu√≠do</option>
          <option value="CANCELADO">Cancelado</option>
        </select>

        <label for="prioridade">Prioridade:</label>
        <select id="prioridade" [(ngModel)]="projetoSelecionado.prioridade">
          <option value="ALTA">Alta</option>
          <option value="MEDIA">M√©dia</option>
          <option value="BAIXA">Baixa</option>
        </select>

        <label for="descricao">Descri√ß√£o:</label>
        <textarea id="descricao" [(ngModel)]="projetoSelecionado.descricao"></textarea>

        <!-- Campo de Senha s√≥ aparece ap√≥s o clique -->
        <div *ngIf="mostrarCampoSenha">
          <label for="senha">Confirme sua senha:</label>
          <input id="senha" type="password" [(ngModel)]="senhaConfirmacao">
        </div>

        <div class="modal-buttons">
          <button (click)="salvarProjeto()">Salvar</button>
          <button *ngIf="!mostrarCampoSenha" (click)="mostrarCampoSenha = true">Excluir</button>
          <button *ngIf="mostrarCampoSenha" (click)="deletarProjeto()">Confirmar Exclus√£o</button>
          <button (click)="fecharDialog()">Fechar</button>
        </div>
      </div>
    </div>
  </div>
  <!-- ================== FIM: MODAL DE PROJETO ================== -->

  <!-- ================== SE√á√ÉO DE PROJETOS COM GR√ÅFICO ================== -->
  <div class="projects-and-chart" [ngClass]="{ 'expand': mostrarGrafico, 'collapsed': !mostrarGrafico }">
    <!-- CARD DE PROJETOS -->
    <div class="project-card">
      <!-- Bot√£o de Toggle: Dentro do Card -->
      <button class="toggle-chart-btn" (click)="alternarGrafico()"
        [title]="mostrarGrafico ? 'Ocultar Gr√°fico' : 'Mostrar Gr√°fico'">
        {{ mostrarGrafico ? '‚û°' : '‚¨Ö' }}
      </button>

      <h2>Projetos</h2>
      <div class="pagination-indicator">
        P√°gina {{ stepIndex + 1 }} de {{ projetosPaginados.length }}
      </div>
      <table>
        <thead>
          <tr>
            <th>Nome do Projeto</th>
            <th>Status</th>
            <th>Prioridade</th>
            <th>A√ß√£o</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let projeto of projetosPaginados[stepIndex]">
            <td>{{ projeto.nome }}</td>
            <td>{{ projeto.status }}</td>
            <td>{{ projeto.prioridade }}</td>
            <td>
              <button class="view-btn" (click)="abrirProjeto(projeto)">üîç</button>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="stepper-buttons">
        <button (click)="voltarStep()" [disabled]="stepIndex === 0">‚¨Ö</button>
        <button (click)="avancarStep()" [disabled]="stepIndex >= projetosPaginados.length - 1">‚û°</button>
      </div>

    </div>

    <!-- GR√ÅFICO -->
    <div class="status-chart-section" [ngClass]="{ 'oculto': !mostrarGrafico }">
      <h2>Status dos Projetos</h2>
      <canvas id="graficoStatusProjetos"></canvas>
    </div>
  </div>
  <!-- ================== FIM: SE√á√ÉO DE PROJETOS COM GR√ÅFICO ================== -->

  <!-- ================== SE√á√ÉO DE USU√ÅRIOS COM √öLTIMOS LOGINS ================== -->
  <div class="users-and-logins" [ngClass]="{ 'expand': mostrarUsuarios, 'collapsed': !mostrarUsuarios }">

    <!-- CARD DE USU√ÅRIOS RECENTES -->
    <div class="recent-users-card">
      <button class="toggle-users-btn" (click)="alternarUsuarios()"
        [title]="mostrarUsuarios ? 'Ocultar Usu√°rios' : 'Mostrar √öltimos Logins'">
        {{ mostrarUsuarios ? '‚û°' : '‚¨Ö' }}
      </button>
      <h2>Usu√°rios Recentes</h2>

      <!-- Barra de Pesquisa sem ngModel -->
      <div class="search-bar">
        <input type="text" placeholder="Buscar usu√°rio..." #usuarioFiltro
          (input)="atualizarFiltro(usuarioFiltro.value)" />
        <button (click)="filtrarUsuarios()">üîç</button>
      </div>

      <!-- Lista de Usu√°rios Filtrados -->
      <ul class="user-list">
        <li *ngFor="let usuario of usuariosFiltrados">
          <div class="user-info">
            <span><strong>{{ usuario.nome }}</strong></span>
            <span>{{ usuario.email }}</span>
          </div>
          <button class="view-btn" (click)="abrirUsuario(usuario)">üîç</button>
        </li>
      </ul>
    </div>

    <!-- CARD DE √öLTIMOS LOGINS -->
    <div class="last-logins-card">
      <h2>√öltimos Logins</h2>
      <ul class="user-list">
        <li *ngFor="let usuario of usuariosLoginsRecentes">
          <div class="user-info">
            <span><strong>{{ usuario.nome }}</strong></span>
            <span>√öltimo Login: {{ usuario.ultimoLogin | date:'dd/MM/yyyy HH:mm' }}</span>
          </div>
        </li>
      </ul>
    </div>
  </div>
  <!-- ================== FIM: SE√á√ÉO DE USU√ÅRIOS COM √öLTIMOS LOGINS ================== -->

</div>